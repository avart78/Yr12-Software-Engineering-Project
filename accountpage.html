<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Page</title>
    <link rel="stylesheet" href="style1.css">
</head>
<body>
   <header>
    <div class="logo">
        <a href="home.html">
    <img src="weblogo.png" alt="Your Logo">
</a>
    </div>
    <nav id="main-nav">
      <ul>
        <li><a href="accountpage.html">Account</a></li>
        <li><a href="ratingpage.html">Rating</a></li>
        <li><a href="aboutus.html">About Us</a></li>
        <li id="login-link"><a href="login.html">Login</a></li>
        <li id="signup-link"><a href="sign-up.html">Sign Up</a></li>
        <li id="user-menu" style="display:none;position:relative;">
          <span id="user-name"></span>
          <img id="user-profile-img" src="" alt="Profile" style="width:32px;height:32px;border-radius:50%;vertical-align:middle;">
          <div id="dropdown" style="display:none;position:absolute;background:#fff;border:1px solid #ccc;z-index:100;">
            <a href="#" id="logout-btn">Logout</a>
          </div>
        </li>
      </ul>
    </nav>
</header>

<div class="account-container">
  <div class="account-details-section">
    <h2>Account Details</h2>
    <form id="account-form" enctype="multipart/form-data">
      <div class="form-group">
        <label for="email">Email</label>
        <input type="email" name="email" id="email" required>
      </div>
      <div class="form-group">
        <label for="username">Username</label>
        <input type="text" name="username" id="username" required>
      </div>
      <div class="form-group">
        <label for="password">Password Change</label>
        <input type="password" name="password" id="password" placeholder="New Password">
      </div>
      <div class="form-group">
        <label for="password2">Confirm Password Change</label>
        <input type="password" name="password2" id="password2" placeholder="Confirm New Password">
      </div>
    </form>
  </div>
  
  <div class="profile-image-section">
    <h2>Profile Image</h2>
    <div class="profile-image-display">
      <img id="profile-img-preview" src="icon-for-user.png" alt="Profile Image">
    </div>
    <input type="file" name="profile_image" id="profile_image" accept="image/*" style="display: none;">
    <button type="button" class="upload-btn" onclick="document.getElementById('profile_image').click()">Upload</button>
  </div>
</div>

<button type="button" class="confirm-btn" onclick="updateAccount()">Confirm</button>
<div id="success-message" class="success-message"></div>

<div class="footer-text">
  <p>
    Procrastination often creates a cycle of avoidance that leads to unfinished work and mounting stress. 
    When tasks are delayed, deadlines approach more quickly, forcing individuals to rush their work or struggle to complete it properly. 
    This last-minute pressure can result in lower-quality outcomes and a sense of overwhelm, making future tasks seem even more daunting. 
    Over time, this habit can lead to chronic stress, affecting both mental and physical well-being by increasing anxiety and reducing productivity. 
    Breaking free from procrastination requires self-discipline, structured planning, and an awareness of its negative effectsâ€”only 
    then can individuals reclaim control over their workload and minimize stress.
  </p>
</div>

<footer class="bottom-footer">
  <p>Arrivederci Procrastinazione = Goodbye Procrastination</p>
  <p>All Rights Reserved 2025</p>
</footer>

<script>
function checkSession() {
  fetch('back-end.php?action=session')
    .then(res => res.json())
    .then(data => {
      if (data.logged_in) {
        document.getElementById('login-link').style.display = 'none';
        document.getElementById('signup-link').style.display = 'none';
        document.getElementById('user-menu').style.display = 'inline-block';
        document.getElementById('user-name').textContent = data.username;
        document.getElementById('user-profile-img').src = data.profile_image || 'icon-for-user.png';
      } else {
        document.getElementById('login-link').style.display = '';
        document.getElementById('signup-link').style.display = '';
        document.getElementById('user-menu').style.display = 'none';
        window.location.href = 'login.html';
      }
    });
}
checkSession();

const userMenu = document.getElementById('user-menu');
if (userMenu) {
  userMenu.addEventListener('mouseenter', function() {
    document.getElementById('dropdown').style.display = 'block';
  });
  userMenu.addEventListener('mouseleave', function() {
    document.getElementById('dropdown').style.display = 'none';
  });
}
const logoutBtn = document.getElementById('logout-btn');
if (logoutBtn) {
  logoutBtn.addEventListener('click', function(e) {
    e.preventDefault();
    fetch('back-end.php?action=logout').then(() => location.reload());
  });
}

function loadAccount() {
  fetch('back-end.php?action=account')
    .then(res => res.json())
    .then(data => {
      if (data.error) { window.location.href = 'login.html'; return; }
      document.getElementById('email').value = data.email;
      document.getElementById('username').value = data.username;
      document.getElementById('profile-img-preview').src = data.profile_image || 'icon-for-user.png';
    });
}
loadAccount();

function updateAccount() {
  const password = document.getElementById('password').value;
  const password2 = document.getElementById('password2').value;
  
  if (password && password !== password2) {
    document.getElementById('success-message').textContent = 'Passwords do not match!';
    document.getElementById('success-message').style.display = 'block';
    document.getElementById('success-message').style.background = '#f44336';
    setTimeout(() => {
      document.getElementById('success-message').style.display = 'none';
    }, 3000);
    return;
  }
  
  const formData = new FormData();
  formData.append('email', document.getElementById('email').value);
  formData.append('username', document.getElementById('username').value);
  if (password) {
    formData.append('password', password);
  }
  
  const fileInput = document.getElementById('profile_image');
  if (fileInput.files.length > 0) {
    formData.append('profile_image', fileInput.files[0]);
  }
  
  fetch('back-end.php?action=account', { method: 'POST', body: formData })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        document.getElementById('success-message').textContent = 'Account updated successfully!';
        document.getElementById('success-message').style.display = 'block';
        document.getElementById('success-message').style.background = '#4CAF50';
        setTimeout(() => {
          document.getElementById('success-message').style.display = 'none';
        }, 3000);
        loadAccount();
        document.getElementById('password').value = '';
        document.getElementById('password2').value = '';
        fileInput.value = '';
      } else {
        document.getElementById('success-message').textContent = data.error;
        document.getElementById('success-message').style.display = 'block';
        document.getElementById('success-message').style.background = '#f44336';
        setTimeout(() => {
          document.getElementById('success-message').style.display = 'none';
        }, 3000);
      }
    });
}

document.getElementById('profile_image').addEventListener('change', function(e) {
  const file = e.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById('profile-img-preview').src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
});
</script>

</body>
</html>




    

